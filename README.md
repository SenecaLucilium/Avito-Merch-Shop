# Avito Merch Shop

Это сервис для внутреннего магазина мерча в компании Avito, где сотрудники могут покупать товары за монеты и переводить их друг другу. Сервис реализует следующие возможности:

- **Авторизация и регистрация:** При первой авторизации пользователь создаётся автоматически и ему выдаётся JWT-токен.  
  Реализация: [app/models/routers/auth.py](app/models/routers/auth.py)

- **Покупка мерча:** Пользователь может приобрести мерчовые товары, если у него достаточно монет. При покупке происходит снижение баланса, создаётся запись о покупке и транзакции монет.  
  Реализация: [app/models/routers/merch.py](app/models/routers/merch.py)

- **Перевод монет:** Пользователь может переводить монеты другому сотруднику. При этом списываются монеты у отправителя и зачисляются у получателя, и создаётся запись транзакции.  
  Реализация: [app/models/routers/transfer.py](app/models/routers/transfer.py)

- **История кошелька и информации:** Пользователь может получить сведения о истории переводов и покупках, а также текущем балансе и инвентаре.  
  Реализация: [app/models/routers/history.py](app/models/routers/history.py)

---

## Технологии и стек

- **Язык:** Python
- **Фреймворк:** FastAPI
- **База данных:** PostgreSQL
- **ORM:** SQLAlchemy
- **Авторизация:** JWT
- **Тестирование:** pytest, FastAPI TestClient, e2e тесты
- **Нагрузочное тестирование:** Locust
- **Контейнеры:** Docker и Docker Compose

## Как запустить проект

1. Убедитесь, что Docker и Docker Compose установлены.
2. Соберите и запустите контейнеры:
   ```sh
   docker-compose up --build
   ```
3. Сервис API будет доступен по адресу http://localhost:8080.

---

## Тестирование

### Юнит-тесты и интеграционные тесты
Запустить тесты можно с помощью команды (из корня проекта):

```sh
   docker-compose run tests
```

Юнит-тесты проверяют сценарии авторизации, покупки мерча, перевода монет и получения информации.

### E2E тесты
Для запуска E2E тестов выполните:

```sh
   docker-compose run e2e-tests
```

E2E тесты (файл tests/e2e_tests.py) покрывают сценарии работы API, такие как покупка мерча и перевод монет между пользователями.

### Нагрузочное тестирование
Нагрузочное тестирование реализовано с помощью Locust. Для его запуска выполните:

```sh
   docker-compose run load-tests
```

Нагрузочный тест доступен по адресу http://localhost:8089 для конфигурации и запуска тестовых сценариев.
